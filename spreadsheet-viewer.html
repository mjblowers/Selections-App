<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Spreadsheet Row Selector</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/styles.css" />
</head>

<body>
    <button id="darkModeToggle" class="dark-mode-toggle" title="Toggle dark mode">üåô</button>
    
    <div class="container">
        <h1>üè† Selection Selector Appy App</h1>

        <div class="upload-section">
            <div class="file-buttons">
                <button id="startScratchBtn" class="file-btn">Select Data Source</button>
                <!-- <button id="existingSpecBtn" class="file-btn secondary">Choose existing spec</button> -->
                <button id="newProjectBtn" class="file-btn" style="background: #e74c3c;">Clear Data</button>
            </div>
            <input type="file" id="fileInput" accept=".xlsx,.xls,.csv" style="display:none" />
            <div class="file-name" id="fileName"></div>
            <div class="error" id="error"></div>
            <div id="debugOutput" style="margin-top:8px;background:#f3f4f6;padding:8px;border-radius:6px;font-size:12px;color:#333;max-height:120px;overflow:auto;display:none;"></div>
        </div>

        <!-- House name + Floor Plan row -->
        <div class="house-row">
            <div class="house-input">
                <input id="houseNameInput" type="text" placeholder="Enter house name" />
                <button id="confirmHouseBtn" type="button" class="file-btn" style="padding:8px 10px;font-size:13px;" onclick="handleConfirmHouse(); return false;">Confirm House</button>
                <button id="editHouseBtn" type="button" class="file-btn secondary" style="display:none;padding:8px 10px;font-size:13px;" onclick="document.getElementById('houseNameInput').disabled = false; this.style.display = 'none'; document.getElementById('confirmHouseBtn').style.display = 'inline-block'; return false;">Edit</button>
            </div>
            <select id="floorPlanSelect" class="floor-plan-select" aria-label="Floor Plan">
                <option value="">-- Floor Plan --</option>
                <option value="Olympia">Olympia</option>
                <option value="Oakley">Oakley</option>
                <option value="MGM Grand">MGM Grand</option>
            </select>
        </div>

        <div class="beds-and-extra-rooms-row">
            <div class="beds-baths-wrapper">
                <label style="font-weight:600;">Beds / Baths</label>
                <div style="display:flex; gap:8px;">
                    <input id="bedsInput" type="number" min="0" placeholder="Beds" style="padding:8px;width:80px;border-radius:6px;border:2px solid #ddd;" />
                    <input id="bathsInput" type="number" min="0" placeholder="Baths" style="padding:8px;width:80px;border-radius:6px;border:2px solid #ddd;" />
                </div>
            </div>

            <div class="extra-rooms-section">
                <label style="font-weight:600;">Extra Rooms</label>
                <div class="toggle-group" id="extraRoomsGroup">
                    <button type="button" class="toggle-btn" data-room="Office">Office</button>
                    <button type="button" class="toggle-btn" data-room="Den">Den</button>
                    <button type="button" class="toggle-btn" data-room="Living">Living</button>
                    <button type="button" class="toggle-btn" data-room="Dining">Dining</button>
                    <button type="button" class="toggle-btn" data-room="Family">Family</button>
                    <button type="button" class="toggle-btn" data-room="Garage">Garage</button>
                    <button type="button" class="toggle-btn" data-room="Kitchen">Kitchen</button>
                    <button type="button" class="toggle-btn" data-room="Pantry">Pantry</button>
                    <button type="button" class="toggle-btn" data-room="Laundry">Laundry</button>
                    <button type="button" class="toggle-btn" data-room="Master Bath">Master Bath</button>
                </div>
            </div>
        </div>

        <div class="beds-baths-controls">
            <button id="setBedsBtn" type="button" class="file-btn" style="padding:8px 10px;font-size:13px;" onclick="handleSetBedsBaths(); return false;">Set House Layout</button>
            <button id="editBedsBtn" type="button" class="file-btn secondary" style="display:none;padding:8px 10px;font-size:13px;">Edit House Layout</button>
        </div>

        <div class="selector-section" id="selectorSection">
            <label for="rowSelect">Select Product Group:</label>
            <div style="display:flex; gap:8px; align-items:center; flex-wrap:wrap;">
                <select id="sheetSelect" style="display:none; min-width: 150px;">
                    <option value="">-- Select Sheet --</option>
                </select>
                <select id="rowSelect">
                    <option value="">-- Choose a row --</option>
                </select>
                <button id="confirmSelectionBtn" class="assign-btn" style="background:#5568d3;">Confirm Selection</button>
            </div>
        </div>

        <div class="row-details" id="rowDetails">
            <h3>Row Details</h3>
            <div id="detailsContent"></div>

            <div class="assign-row">
                <select id="roomSelect">
                    <option value="">-- Choose a room --</option>
                </select>
                <button id="assignBtn" class="assign-btn">Assign to Room</button>
                <button id="assignCurrentBtn" class="assign-btn" style="background:#5568d3; margin-left:6px;">Add to Current Room</button>
            </div>
        </div>

        <div class="selected-items" id="selectedItems">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
                <h3>Selected Room to Add Item</h3>
                <button id="showAllBtn" class="file-btn" style="padding:8px 14px; font-size:13px;">Show All</button>
            </div>
            <div style="display:flex; gap:16px; width:100%;">
                <div style="display:flex; flex-direction:column; gap:8px; min-width:150px;">
                    <div style="font-weight:600; font-size:14px;">Product Group:</div>
                    <div id="sheetTabs" class="sheet-tabs" style="display:flex; flex-direction:column; gap:4px;"></div>
                </div>
                <div style="display:flex; flex-direction:column; gap:8px; min-width:150px;">
                    <div style="font-weight:600; font-size:14px; color:#333;">Rooms:</div>
                    <div id="roomTabs" class="room-tabs" aria-label="Room Tabs" style="display:flex; flex-direction:column; gap:4px;"></div>
                </div>
                <div id="roomTabContent" class="room-tab-content" style="flex:1;"></div>
                <div id="showAllContent" class="show-all-content" style="display:none; flex:1;"></div>
            </div>

        <div style="text-align: center; margin-top: 20px;">
            <button id="exportBtn" class="file-btn" disabled>Export to Excel</button>
        </div>
    </div>

    <!-- External libraries -->
    <script src="https://cdn.jsdelivr.net/npm/exceljs/dist/exceljs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
    
    <!-- Application modules -->
    <script src="js/modules/state.js"></script>
    <script src="js/modules/ui.js"></script>
    <script src="js/app.js"></script>

    <script>
        // Initialize the app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }

        // Initialize Select2 dropdowns
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (window.jQuery && jQuery.fn && jQuery.fn.select2) {
                    jQuery('#rowSelect').select2({
                        placeholder: 'Search for a row...',
                        allowClear: true,
                        width: '100%'
                    });
                    jQuery('#roomSelect').select2({
                        placeholder: 'Search for a room...',
                        allowClear: true,
                        width: '100%'
                    });
                }
            }, 100);
        });
    </script>
</body>

</html>